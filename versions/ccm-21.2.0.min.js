(()=>{const components={};const Datastore=function(){const callbacks=[];let that;let user;this.init=(async()=>{that=this;await prepareDB();await prepareRealtime();delete that.init;async function prepareDB(){if(!that.name||that.url)return;await openDB();await createStore();function openDB(){return new Promise(resolve=>db?resolve():indexedDB.open("ccm").onsuccess=function(){db=this.result;resolve()})}function createStore(){return new Promise(resolve=>{if(db.objectStoreNames.contains(that.name))return resolve();let version=parseInt(localStorage.getItem("ccm"));if(!version)version=1;db.close();const request=indexedDB.open("ccm",version+1);request.onupgradeneeded=function(){db=this.result;localStorage.setItem("ccm",db.version);db.createObjectStore(that.name,{keyPath:"key"})};request.onsuccess=resolve})}}function prepareRealtime(){return new Promise(resolve=>{if(!that.url||that.url.indexOf("ws")!==0)return resolve();if(!that.onchange&&that.parent)that.onchange=that.parent.start;let message=[that.db,that.name];if(that.dataset){if(!Array.isArray(that.dataset))that.dataset=[that.dataset];message=message.concat(that.dataset)}that.socket=new WebSocket(that.url,"ccm-cloud");that.socket.onmessage=(message=>{const{callback:callback,data:data}=self.helper.parse(message.data);if(callback){callbacks[callback](data);delete callbacks[callback]}else that.onchange&&that.onchange(data)});that.socket.onopen=(()=>{that.socket.send(message);resolve()})})}});this.clear=(()=>that.local={});this.source=(()=>{return{name:that.name,url:that.url,db:that.db}});this.get=((key_or_query={})=>new Promise((resolve,reject)=>{key_or_query=self.helper.clone(key_or_query);if(!self.helper.isObject(key_or_query)&&!self.helper.isKey(key_or_query))reject(new Error("invalid dataset key: "+key_or_query));that.url?serverDB():that.name?clientDB():localCache();function localCache(){resolve(self.helper.clone(self.helper.isObject(key_or_query)?runQuery(key_or_query):that.local[key_or_query]));function runQuery(query){const results=[];for(const key in that.local)self.helper.isSubset(query,that.local[key])&&results.push(that.local[key]);return results}}function clientDB(){const store=getStore();const request=self.helper.isObject(key_or_query)?store.getAll():store.get(key_or_query);request.onsuccess=(event=>resolve(event.target.result||null));request.onerror=(event=>reject(event.target.errorCode))}function serverDB(){(that.socket?useWebsocket:useHttp)(prepareParams({get:key_or_query})).then(resolve).catch(error=>checkError(error,reject))}}));this.set=(priodata=>new Promise((resolve,reject)=>{priodata=self.helper.toJSON(priodata);if(!priodata.key)priodata.key=self.helper.generateKey();if(!self.helper.isKey(priodata.key))reject(new Error("invalid dataset key: "+priodata.key));that.url?serverDB():that.name?clientDB():localCache();function localCache(){if(that.local[priodata.key])that.local[priodata.key]=self.helper.integrate(priodata,that.local[priodata.key]);else that.local[priodata.key]=priodata;resolve(priodata.key)}function clientDB(){const request=getStore().put(priodata);request.onsuccess=(event=>event.target.result.toString()===priodata.key.toString()?resolve(event.target.result):reject(event.target.result));request.onerror=(event=>reject(event.target.errorCode))}function serverDB(){(that.socket?useWebsocket:useHttp)(prepareParams({set:priodata})).then(response=>(response.toString()===priodata.key.toString()?resolve:reject)(response)).catch(error=>checkError(error,reject))}}));this.del=(key=>new Promise((resolve,reject)=>{if(!self.helper.isKey(key))reject(new Error("invalid dataset key: "+key));that.url?serverDB():that.name?clientDB():localCache();function localCache(){delete that.local[key];resolve(true)}function clientDB(){const request=getStore().delete(key);request.onsuccess=(event=>event.target.result===undefined?resolve(true):reject(event.target.result));request.onerror=(event=>reject(event.target.errorCode))}function serverDB(){(that.socket?useWebsocket:useHttp)(prepareParams({del:key})).then(response=>(response===true?resolve:reject)(response)).catch(error=>checkError(error,reject))}}));function getStore(){return db.transaction([that.name],"readwrite").objectStore(that.name)}function prepareParams(params={}){if(that.db)params.db=that.db;params.store=that.name;user=self.context.find(that,"user");if(user&&user.isLoggedIn()){params.realm=user.getRealm();params.token=user.data().token}return params}async function checkError(error,reject){if(error.data.status===401&&user){try{await user.logout();await user.login();await self.context.root(user).start()}catch(e){await self.context.root(user).start()}}else reject(error)}function useWebsocket(params){return new Promise(resolve=>{const key=self.helper.generateKey();callbacks[key]=resolve;params.callback=key;that.socket.send(self.helper.stringify(params))})}function useHttp(params){return self.load({url:that.url,params:params,method:that.method})}};let db;if(!window.ccm)ccm={callbacks:{},files:{}};const self={version:()=>"21.2.0",components:{},load:function(){const args=[...arguments];const call=args.slice(0);call.unshift(self.load);let results=[];let counter=1;let failed=false;return new Promise((resolve,reject)=>{args.forEach((resource,i)=>{counter++;resource=self.helper.clone(resource);if(Array.isArray(resource)){results[i]=[];serial(null);return}if(!self.helper.isObject(resource))resource={url:resource};const suffix=resource.url.split(".").pop().toLowerCase();if(resource.method)resource.method=resource.method.toLowerCase();if(!resource.context||resource.context==="head")resource.context=document.head;if(self.helper.isInstance(resource.context))resource.context=resource.context.element.parentNode;const operation=getOperation();let timeout;self.load.timeout&&self.helper.wait(self.load.timeout,()=>timeout===undefined&&(timeout=true)&&error("timeout"));operation();function serial(result){if(result!==null)results[i].push(result);if(resource.length===0)return check();let next=resource.shift();if(!Array.isArray(next))next=[next];self.load.apply(null,next).then(serial).catch(serial)}function getOperation(){switch(resource.type){case"html":return importHTML;case"image":return loadImage;case"css":return loadCSS;case"js":return loadJS;case"module":return loadModule;case"xml":return loadXML;case"data":return loadData}switch(suffix){case"html":return importHTML;case"jpg":case"jpeg":case"gif":case"png":case"svg":case"bmp":return loadImage;case"css":return loadCSS;case"js":return loadJS;case"xml":return loadXML;default:return loadData}}function importHTML(){if("import"in document.createElement("link"))proceed();else self.load({url:"https://ccmjs.github.io/ccm/polyfills/webcomponents-hi.js",integrity:"sha384-d6TZ9MlI5H/Q0IpJX6FP+ImfcDNnOBkaRrIfjCm9mo/qakdFoEvrcIX1mWk0L+Qa",crossorigin:"anonymous"}).then(proceed).catch(()=>error("failed loading HTML Import polyfill"));function proceed(){let element={tag:"link",rel:"import",href:resource.url,async:true};if(resource.attr)element=self.helper.integrate(resource.attr,element);element=self.helper.html(element);element.onload=(()=>{const fragment=document.createDocumentFragment();const children=element.import.body.childNodes;for(let i=children.length-1;i>-1;i--)fragment.prepend(children[i]);successData(fragment)});element.onerror=(event=>{self.helper.removeElement(element);error(element,event)});document.head.appendChild(element)}}function loadImage(){const image=new Image;image.onload=success;image.onerror=(event=>error(image,event));image.src=resource.url}function loadCSS(){let element={tag:"link",rel:"stylesheet",type:"text/css",href:resource.url};if(resource.attr)element=self.helper.integrate(resource.attr,element);element=self.helper.html(element);element.onload=success;element.onerror=(event=>{self.helper.removeElement(element);error(element,event)});resource.context.appendChild(element)}function loadJS(){const filename=resource.url.split("/").pop().replace(".min.",".");ccm.files[filename]=null;ccm.files["#"+filename]=ccm.files["#"+filename]?ccm.files["#"+filename]+1:1;let element={tag:"script",src:resource.url};if(resource.attr)element=self.helper.integrate(resource.attr,element);element=self.helper.html(element);element.onload=(()=>{const data=ccm.files[filename];if(!--ccm.files["#"+filename]){delete ccm.files[filename];delete ccm.files["#"+filename]}self.helper.removeElement(element);data!==null?successData(data):success()});element.onerror=(event=>{self.helper.removeElement(element);error(element,event)});resource.context.appendChild(element)}function loadModule(){const callback="callback"+self.helper.generateKey();ccm.callbacks[callback]=function(result){self.helper.removeElement(element);delete ccm.callbacks[callback];successData(result)};const element=self.helper.html({tag:"script",type:"module"});element.onerror=(event=>{self.helper.removeElement(element);error(element,event)});element.text="import * as alias from '"+resource.url+"'; ccm.callbacks['"+callback+"']( alias"+(resource.import?"."+resource.import:"")+" )";document.head.appendChild(element)}function loadXML(){if(!resource.method)resource.method="post";const request=new XMLHttpRequest;request.onreadystatechange=(()=>{if(request.readyState===4)request.status===200?successData(request.responseXML):error(request)});request.open(resource.method,resource.url,true);request.send()}function loadData(){switch(resource.method){case"jsonp":jsonp();break;case"get":case"post":case"put":case"delete":ajax();break;case"fetch":fetchAPI();break;default:resource.method="post";ajax()}function jsonp(){const callback="callback"+self.helper.generateKey();if(!resource.params)resource.params={};resource.params.callback="ccm.callbacks."+callback;ccm.callbacks[callback]=(data=>{self.helper.removeElement(element);delete ccm.callbacks[callback];successData(data)});let element={tag:"script",src:buildURL(resource.url,resource.params)};if(resource.attr)element=self.helper.integrate(resource.attr,element);element=self.helper.html(element);element.onerror=(event=>{self.helper.removeElement(element);error(element,event)});element.src=element.src.replace(/&amp;/g,"&");resource.context.appendChild(element)}function ajax(){const request=new XMLHttpRequest;request.open(resource.method,resource.method==="get"&&resource.params?buildURL(resource.url,resource.params):resource.url,true);if(resource.headers)for(const key in resource.headers){request.setRequestHeader(key,resource.headers[key]);if(key.toLowerCase()==="authorization")request.withCredentials=true}(resource.method==="post"||resource.method==="put")&&request.setRequestHeader("Content-Type","application/json");request.onreadystatechange=(()=>{if(request.readyState===4)request.status>=200&&request.status<300?successData(request.responseText):error(request)});request.send(resource.method==="post"||resource.method==="put"?self.helper.stringify(resource.params):undefined)}function fetchAPI(){if(!resource.init)resource.init={};if(resource.params)resource.init.method.toLowerCase()==="post"?resource.init.body=self.helper.stringify(resource.params):resource.url=buildURL(resource.url,resource.params);fetch(resource.url,resource.init).then(response=>response.text()).then(successData).catch(error)}function buildURL(url,data){if(self.helper.isObject(data.json))data.json=self.helper.stringify(data.json);return data?url+"?"+params(data).slice(0,-1):url;function params(obj,prefix){let result="";for(const i in obj){const key=prefix?prefix+"["+encodeURIComponent(i)+"]":encodeURIComponent(i);if(typeof obj[i]==="object")result+=params(obj[i],key);else result+=key+"="+encodeURIComponent(obj[i])+"&"}return result}}}function successData(data){if(checkTimeout())return;if(typeof data==="string")try{data=self.helper.parse(data)}catch(e){}results[i]=self.helper.protect(data);success()}function success(){if(checkTimeout())return;if(results[i]===undefined)results[i]=resource.url;check()}function checkTimeout(){return timeout?self.helper.log("loading of "+resource.url+" succeeded after timeout ("+self.load.timeout+"ms)")||true:timeout=false}function error(){failed=true;results[i]={error:new Error("loading of "+resource.url+" failed"),resource:resource,data:[...arguments],call:call};if(results[i].data.length<=1)results[i].data=results[i].data[0];check()}});check();function check(){if(--counter)return;if(results.length===1)results=results[0];(failed?reject:resolve)(results)}})},component:async(component,config)=>{component=await getComponentObject();if(!self.helper.isComponent(component))return new Error("invalid component object");await changeFrameworkVersion(component,config);const version=(self.helper.isFramework(component.ccm)?component.ccm:await self.helper.loadFramework(component.ccm)).version();if(version!==self.version())return new Promise(async resolve=>{const result=await ccm[version].component(component,config,resolve);result&&resolve(result)});component.index=component.name+(component.version?"-"+component.version.join("-"):"");if(!components[component.index]){components[component.index]=component;self.components[component.index]={};component.instances=0;component.ccm=ccm[version];component.ready&&await component.ready.call(component);delete component.ready;await defineCustomElement();async function defineCustomElement(){if(!("customElements"in window))await self.load({url:"https://ccmjs.github.io/ccm/polyfills/webcomponents-lite.js",attr:{integrity:"sha384-yEuTKRGFLhOAfHNxaZiiI23KhMelYudrPUNSUK6T5u1+deGEEKsQ89cS0sPIHjyj",crossorigin:"anonymous"}});const name="ccm-"+component.index;if(customElements.get(name))return;window.customElements.define(name,class extends HTMLElement{async connectedCallback(){if(!document.body.contains(this))return;let node=this;while(node=node.parentNode)if(node.tagName&&node.tagName.indexOf("CCM-")===0)return;await self.helper.sleep(0);const config=self.helper.generateConfig(this);this.removeAttribute("key");config.root=this;await component.start(config)}})}}else component=components[component.index];component=self.helper.clone(component);component.config=await prepareConfig(config,component.config);component.instance=(async config=>await self.instance(component,await prepareConfig(config,component.config)));component.start=(async config=>await self.start(component,await prepareConfig(config,component.config)));return component;async function getComponentObject(){if(typeof component==="string"){const index=self.helper.getIndex(component);if(components[index])return self.helper.clone(components[index]);if(self.helper.regex("filename").test(component.split("/").pop())){const response=await self.load(component);response.url=component;return response}return new Error("invalid component index or URL: "+component)}return component}},instance:async(component,config)=>{if(config&&config.root)self.helper.setContent(config.root,self.helper.loading(config.parent));component=await self.component(component,{ccm:config&&config.ccm});config&&delete config.ccm;if(component.ccm.version()!==self.version())return new Promise(async resolve=>{const result=await ccm[component.ccm.version()].instance(component,config,resolve);result&&resolve(result)});config=await prepareConfig(config,component.config);let instance=createInstance();instance.config=self.helper.stringify(config);if(!document.contains(instance.root)){instance.root.position=document.createElement("div");if(instance.root.parentNode)instance.root.parentNode.replaceChild(instance.root.position,instance.root);document.head.appendChild(instance.root)}config=await self.helper.solveDependencies(config,instance);if(document.head.contains(instance.root)){document.head.removeChild(instance.root);if(instance.root.position.parentNode)instance.root.position.parentNode.replaceChild(instance.root,instance.root.position);delete instance.root.placeholder}config.inner=self.helper.html(config.inner);Object.assign(instance,config);if(!instance.parent||!instance.parent.init)await initialize();return instance;function createInstance(){const instance=new component.Instance;instance.ccm=component.ccm;instance.component=component;instance.parent=config.parent;delete config.parent;instance.root=config.root;delete config.root;instance.id=++components[component.index].instances;instance.index=component.index+"-"+instance.id;setElement();if(!instance.init)instance.init=(async()=>{});if(instance.root.id===instance.index&&instance.root.parentNode&&instance.root.parentNode.tagName.indexOf("CCM-")===0)watchAttributes();return instance;function setElement(){if(instance.root==="parent"&&instance.parent){instance.root=instance.parent.root;instance.element=instance.parent.element;return}if(instance.root==="name"&&instance.parent)instance.root=instance.parent.element.querySelector("#"+component.name);const root=self.helper.html({id:instance.index});if(instance.root)self.helper.setContent(instance.root,root);instance.root=root;const shadow=root.shadowRoot||root.attachShadow({mode:"open"});self.helper.setContent(shadow,instance.element=self.helper.html({id:"element"}));self.helper.setContent(instance.element,self.helper.loading(instance))}function watchAttributes(){if(!instance.update)instance.update=((key,value)=>{switch(key){case"ccm":case"component":case"config":case"element":case"id":case"index":case"init":case"onfinish":case"parent":case"ready":case"root":case"start":case"update":break;case"key":if(self.helper.regex("json").test(value))value=self.helper.parse(value);if(self.helper.isObject(value))for(const key in value)if(value.hasOwnProperty(key))switch(key){case"ccm":case"component":case"dependency":case"parent":case"id":case"index":case"element":case"root":case"init":case"ready":case"start":case"update":case"key":break;default:instance[key]=value[key]}instance.start();break;default:instance[key]=value;instance.start()}});const MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;const observer=new MutationObserver(mutations=>mutations.forEach(mutation=>{if(mutation.type!=="attributes")return;const key=mutation.attributeName;const value=instance.root.parentNode.getAttribute(key);instance.update(key,value)}));observer.observe(instance.root.parentNode,{attributes:true})}}function initialize(){return new Promise(resolve=>{const instances=[instance];find(instance);let i=0;init();function find(obj){const relevant=[];for(const key in obj)if(obj.hasOwnProperty&&obj.hasOwnProperty(key)){const value=obj[key];if(self.helper.isInstance(value)&&key!=="parent"&&!self.helper.isProxy(value)){instances.push(value);relevant.push(value)}else if(Array.isArray(value)||self.helper.isObject(value)){if(self.helper.isSpecialObject(value))continue;relevant.push(value)}}relevant.map(find)}function init(){if(i===instances.length)return ready();const next=instances[i++];next.init?next.init().then(()=>{delete next.init;init()}):init()}function ready(){if(!instances.length)return resolve();const next=instances.pop();next.ready?next.ready().then(()=>{delete next.ready;ready()}):ready();if(next._start){delete next._start;next.start()}}})}},proxy:async(component,config)=>{const obj={ccm:true,component:{Instance:true}};obj.start=(async cfg=>await Object.assign(obj,await self.instance(component,self.helper.integrate(cfg,config))).start());return obj},start:async(component,config)=>{const instance=await self.instance(component,config);instance.init?instance._start=true:await instance.start();return instance},store:config=>new Promise((resolve,reject)=>{config=self.helper.clone(config);if(typeof config==="string")config=config.endsWith(".js")?{local:["ccm.load",config]}:{name:config};if(!self.helper.isObject(config)||!config.local&&!config.name){config={local:config,parent:config.parent};delete config.local.parent}if(!config.local&&!config.name)config.local={};self.helper.solveDependency(config.local).then(result=>{config.local=result;if(Array.isArray(config.local))config.local=self.helper.arrToStore(config.local);let store=new Datastore;Object.assign(store,config);store.init().then(()=>resolve(store))}).catch(reject)}),get:(settings,key_or_query)=>self.store(settings).then(store=>{let property;if(typeof key_or_query==="string"){property=key_or_query.split(".");key_or_query=property.shift();property=property.join(".")}return store.get(key_or_query).then(result=>property?self.helper.deepValue(result,property):result)}),set:(settings,priodata)=>self.store(settings).then(store=>store.set(priodata)),del:(settings,key)=>self.store(settings).then(store=>store.del(key)),context:{find:(instance,property,not_me)=>{const start=instance;if(not_me)instance=instance.parent;do{if(self.helper.isObject(instance)&&instance[property]!==undefined&&instance[property]!==start)return instance[property]}while(instance=instance.parent)},highestByProperty:(instance,property,not_me)=>{const start=instance;let result=null;if(not_me)instance=instance.parent;do{if(self.helper.isObject(instance)&&instance[property]!==undefined&&instance[property]!==start)result=instance}while(instance=instance.parent);return result},nearestByProperty:(instance,property,not_me)=>{const start=instance;if(not_me)instance=instance.parent;do{if(self.helper.isObject(instance)&&instance[property]!==undefined&&instance[property]!==start)return instance}while(instance=instance.parent);return null},root:function(instance){while(instance.parent)instance=instance.parent;return instance}},helper:{action:function(action,context){if(typeof action==="function")return action();if(!Array.isArray(action))action=action.split(" ");if(self.helper.isObject(action[0]))return new Promise(resolve=>self.load({url:action[0].module,type:"module",import:action[0].import}).then(result=>resolve(result.apply(window,action.slice(1)))));if(typeof action[0]==="function")return action[0].apply(window,action.slice(1));else if(action[0].indexOf("this.")===0)return this.executeByName(action[0].substr(5),action.slice(1),context);else return this.executeByName(action[0],action.slice(1))},append:function(parent,node){node=self.helper.protect(node);parent.appendChild(node)},arrToObj:function arrToObj(obj,key){var arr=key?obj[key]:obj;if(!Array.isArray(arr))return;var result={};arr.map(function(value){result[value]=true});if(key)obj[key]=result;return result},arrToStore:arr=>{if(!Array.isArray(arr))return;const obj={};arr.forEach(value=>{if(self.helper.isDataset(value))obj[value.key]=value});return obj},asyncForEach:async function(array,callback){for(let i=0;i<array.length;i++)await callback(array[i],i,array)},cleanObject:function(obj){for(var key in obj)if(!obj[key])delete obj[key];else if(typeof obj[key]==="object"&&!self.helper.isNode(obj[key])&&!self.helper.isInstance(obj[key]))self.helper.cleanObject(obj[key]);return obj},clone:function(value){return recursive(value,true);function recursive(value,first){if(self.helper.isSpecialObject(value)&&!first)return value;if(Array.isArray(value)||self.helper.isObject(value)){var copy=Array.isArray(value)?[]:{};for(var i in value)copy[i]=recursive(value[i]);return copy}return value}},compareVersions:(a,b)=>{if(a===b)return 0;const a_arr=a.split(".");const b_arr=b.split(".");for(let i=0;i<3;i++){const x=parseInt(a_arr[i]);const y=parseInt(b_arr[i]);if(x<y)return-1;else if(x>y)return 1}return 0},convertObjectKeys:function(obj){var keys=Object.keys(obj);keys.map(function(key){if(key.indexOf(".")!==-1){self.helper.deepValue(obj,key,obj[key]);delete obj[key]}});return obj},dataset:async function(settings={}){if(self.helper.isDatastore(settings))settings={store:settings};settings=self.helper.clone(settings);if(!settings||!self.helper.isDatastore(settings.store))return settings;if(!settings.key&&self.helper.isKey(arguments[1]))settings.key=arguments[1];if(!settings.key)settings.key=self.helper.generateKey();if(self.helper.isDataset(settings.key))return settings.convert?settings.convert(settings.key):settings.key;const user=self.context.find(settings.store,"user");if(user&&settings.login)await user.login();if(self.helper.isInstance(user)&&settings.user&&user.isLoggedIn())settings.key=[settings.key,user.data().user];let dataset=await settings.store.get(settings.key);if(!dataset){dataset={key:settings.key};if(settings.permissions)dataset._=settings.permissions}if(settings.convert)dataset=settings.convert(dataset);return dataset},decodeObject:str=>{if(typeof str==="string"){str=str.replace(/'/g,'"');if(self.helper.regex("json").test(str))str=self.helper.parse(str);return str}if(typeof str==="object"&&!self.helper.isNode(str)&&!self.helper.isInstance(str))for(const key in str)str[key]=self.helper.decodeObject(str[key]);return str},deepValue:function(obj,key,value){return recursive(obj,key.split("."),value);function recursive(obj,key,value){if(!obj)return;var next=key.shift();if(key.length===0)return value!==undefined?obj[next]=value:obj[next];if(!obj[next]&&value!==undefined)obj[next]=isNaN(key[0])?{}:[];return recursive(obj[next],key,value)}},encodeObject:(obj,inner)=>{if(typeof obj!=="object")return obj;if(!inner)return self.helper.stringify(obj).replace(/"/g,"'");for(const key in obj)if(typeof obj[key]==="object")obj[key]=self.helper.stringify(obj[key]).replace(/"/g,"'");return obj},encodeDependencies:value=>{if(self.helper.isDependency(value))return self.helper.stringify(value).replace(/"/g,"'");if(typeof value!=="object"||self.helper.isNode(value)||self.helper.isInstance(value))return value;for(const key in value)value[key]=self.helper.encodeDependencies(value[key]);return value},escapeHTML:value=>{const text=document.createTextNode(value);const div=document.createElement("div");div.appendChild(text);return div.innerHTML},executeByName:function(functionName,args,context){if(!context)context=window;var namespaces=functionName.split(".");functionName=namespaces.pop();for(var i=0;i<namespaces.length;i++)context=context[namespaces[i]];return context[functionName].apply(context,args)},fillForm:(element,data)=>{data=self.helper.clone(self.helper.protect(data));const dot=self.helper.toDotNotation(data,true);for(const key in dot)data[key]=dot[key];for(const key in data){if(!data[key])continue;if(typeof data[key]==="object")data[key]=self.helper.encodeObject(data[key]);if(typeof data[key]==="string")data[key]=self.helper.unescapeHTML(data[key]);[...element.querySelectorAll('[name="'+key+'"]')].map(input=>{if(input.type==="checkbox"){if(input.value&&typeof data[key]==="string"&&data[key].charAt(0)==="[")self.helper.decodeObject(data[key]).map(value=>{if(value===input.value)input.checked=true});else input.checked=true}else if(input.type==="radio"){if(data[key]===input.value)input.checked=true}else if(input.tagName.toLowerCase()==="select"){if(input.hasAttribute("multiple"))data[key]=self.helper.decodeObject(data[key]);[...input.querySelectorAll("option")].map(option=>{if(input.hasAttribute("multiple"))data[key].map(value=>{value=self.helper.encodeObject(value);if(value===(option.value?option.value:option.innerHTML.trim()))option.selected=true});else if(data[key]===(option.value?option.value:option.innerHTML.trim()))option.selected=true})}else if(input.value===undefined)input.innerHTML=data[key];else input.value=data[key]})}},filterProperties:function(obj,properties){const result={};properties=[...arguments];properties.shift();properties.forEach(property=>{if(obj[property]!==undefined)result[property]=obj[property]});return result},findParentElementByClass:function(elem,value){while(elem&&elem.classList&&!elem.classList.contains(value))elem=elem.parentNode;return elem.classList.contains(value)?elem:null},format:function(data,values){const temp=[[],[],{}];const obj_mode=self.helper.isObject(data);values=self.helper.clone([...arguments]);values.shift();data=self.helper.stringify(data,(key,val)=>{if(typeof val==="function"){temp[0].push(val);return"%$0%"}return val});for(let i=0;i<values.length;i++){if(typeof values[i]==="object"){for(const key in values[i])if(values[i].hasOwnProperty(key)){if(typeof values[i][key]!=="string"&&obj_mode){temp[2][key]=values[i][key];values[i][key]=`%$2%${key}%`}data=data.replace(new RegExp(`%${key}%`,"g"),values[i][key])}}else{if(typeof values[i]!=="string"&&obj_mode){temp[1].push(values[i]);values[i]="%$1%"}data=data.replace(/%%/,values[i])}}return self.helper.parse(data,(key,val)=>{if(val==="%$0%")return temp[0].shift();if(val==="%$1%")return temp[1].shift();if(typeof val==="string"){if(val.indexOf("%$2%")===0&&val.split("%")[3]==="")return temp[2][val.split("%")[2]];else for(const key in temp[2])val=val.replace(new RegExp(`%\\$2%${key}%`,"g"),temp[2][key])}return val})},formData:element=>{const data={};[...element.querySelectorAll("[name]")].map(input=>{let name=input.getAttribute("name");if(input.type==="checkbox"){const value=input.checked?input.value==="on"?true:input.value:input.value==="on"?false:"";const multi=[...element.querySelectorAll('[name="'+name+'"]')].length>1;if(multi){if(!data[name])data[name]=[];data[name].push(value)}else data[name]=value}else if(input.type==="radio")data[name]=input.checked?input.value:data[name]?data[name]:"";else if(input.tagName.toLowerCase()==="select"){let result=[];if(input.hasAttribute("multiple"))[...input.querySelectorAll("option")].map(option=>option.selected&&result.push(option.value?option.value:option.inner));else[...input.querySelectorAll("option")].map(option=>{if(option.selected)result=option.value?option.value:option.inner});data[name]=result}else if(input.type==="number"||input.type==="range"){let value=parseInt(input.value);if(isNaN(value))value="";data[name]=value}else if(input.value!==undefined)data[name]=input.value;else data[input.getAttribute("name")]=input.innerHTML;try{if(typeof data[name]==="string")if(self.helper.regex("json").test(data[name]))data[name]=self.helper.decodeObject(data[name]);else data[name]=data[name].replace(/"/g,'\\"')}catch(err){}});return self.helper.protect(self.helper.solveDotNotation(data))},generateConfig:function(node){var config={};catchAttributes(node,config);catchInnerTags(node);return config;function catchAttributes(node,obj){self.helper.makeIterable(node.attributes).map(function(attr){if(attr.name!=="src"||node.tagName.indexOf("CCM-COMPONENT")!==0&&node.tagName.indexOf("CCM-INSTANCE")!==0&&node.tagName.indexOf("CCM-PROXY")!==0)try{obj[attr.name]=attr.value.charAt(0)==="{"||attr.value.charAt(0)==="["?self.helper.parse(attr.value):prepareValue(attr.value)}catch(err){}})}function catchInnerTags(node){config.childNodes=[];self.helper.makeIterable(node.childNodes).map(function(child){if(child.tagName&&child.tagName.indexOf("CCM-")===0){var split=child.tagName.toLowerCase().split("-");if(split.length<3)split[2]=split[1];switch(split[1]){case"load":self.helper.deepValue(config,split[2],interpretLoadTag(child,split[2]));break;case"component":case"instance":case"proxy":self.helper.deepValue(config,split[2],["ccm."+split[1],child.getAttribute("src")||split[2],self.helper.generateConfig(child)]);break;case"store":case"get":var settings={};catchAttributes(child,settings);var key=settings.key;delete settings.key;self.helper.deepValue(config,split[2],["ccm."+split[1],settings,key]);break;case"list":var list=null;self.helper.makeIterable(child.children).map(function(entry){if(entry.tagName&&entry.tagName.indexOf("CCM-ENTRY")===0){var value=prepareValue(entry.getAttribute("value"));var split=entry.tagName.toLowerCase().split("-");if(!list)list=split.length<3?[]:{};if(split.length<3)list.push(value);else self.helper.deepValue(list,split[2],value)}});if(!list)list={};catchAttributes(child,list);if(list)self.helper.deepValue(config,split[2],list);break;default:config.childNodes.push(child);node.removeChild(child)}}else{config.childNodes.push(child);node.removeChild(child)}});if(config.inner)return;config.inner=self.helper.html({});config.childNodes.map(function(child){config.inner.appendChild(child)});delete config.childNodes;if(!config.inner.hasChildNodes())delete config.inner;function interpretLoadTag(node){var params=generateParameters(node);if(!Array.isArray(params))params=[params];params.unshift("ccm.load");if(node.hasAttribute("head"))params.push(true);return params;function generateParameters(node){if(node.hasAttribute("src")){if(node.children.length===0)return node.getAttribute("src");var data={};self.helper.makeIterable(node.children).map(function(child){if(child.tagName&&child.tagName.indexOf("CCM-DATA-")===0)data[child.tagName.toLowerCase().split("-")[2]]=child.getAttribute("value")});return[node.getAttribute("src"),data]}var params=[];self.helper.makeIterable(node.children).map(function(child){if(child.tagName==="CCM-SERIAL"&&(node.tagName==="CCM-PARALLEL"||node.tagName.indexOf("CCM-LOAD")===0)||child.tagName==="CCM-PARALLEL"&&node.tagName==="CCM-SERIAL")params.push(generateParameters(child))});return params}}}function prepareValue(value){if(value==="true")return true;if(value==="false")return false;if(value==="null")return null;if(value==="undefined")return undefined;if(value==="")return"";if(!isNaN(value))return parseInt(value);return value}},generateKey:function(){return Date.now()+"X"+Math.random().toString().substr(2)},getElementID:function(instance){return"ccm-"+instance.index},getIndex:function(url){if(url.indexOf(".js")===-1)return url;var filename=url.split("/").pop();if(!self.helper.regex("filename").test(filename))return"";var split=filename.split(".");if(split[0]==="ccm")split.shift();split.pop();if(split[split.length-1]==="min")split.pop();return split.join("-")},hasDomContact:instance=>document.contains(self.context.root(instance).root),hide:function(instance){instance.element.parentNode.appendChild(self.helper.loading(instance));instance.element.style.display="none"},html:function(html,values){if(typeof html==="string")html=document.createRange().createContextualFragment(html);if(window.jQuery&&html instanceof jQuery){html=html.get();const fragment=document.createDocumentFragment();html.map(elem=>fragment.appendChild(elem));html=fragment}if(self.helper.isNode(html))return html;html=self.helper.clone(html);if(arguments.length>1)html=self.helper.format.apply(this,arguments);if(Array.isArray(html)){var result=[];for(var i=0;i<html.length;i++)result.push(self.helper.html(html[i]));return result}if(typeof html!=="object"||html===null)return html;var element=document.createElement(self.helper.htmlEncode(html.tag||"div"));delete html.tag;if(!self.helper.regex("json").test(html.key))delete html.key;for(var key in html){var value=html[key];switch(key){case"async":case"autofocus":case"checked":case"defer":case"disabled":case"ismap":case"multiple":case"required":case"selected":if(value)element[key]=true;break;case"readonly":if(value)element.readOnly=true;break;case"inner":if(typeof value==="string"||typeof value==="number"){element.innerHTML=value;break}var children=this.html(value);if(!Array.isArray(children))children=[children];for(var i=0;i<children.length;i++)if(self.helper.isNode(children[i]))element.appendChild(children[i]);else element.innerHTML+=children[i];break;default:if(key.indexOf("on")===0&&typeof value==="function")element.addEventListener(key.substr(2),value);else element.setAttribute(key,self.helper.htmlEncode(value,true,false))}}return self.helper.protect(element)},htmlEncode:function(value,trim,quot){if(typeof value!=="string")value=value.toString();value=trim||trim===undefined?value.trim():value;var tag=document.createElement("span");tag.innerHTML=value;value=tag.textContent;value=quot||quot===undefined?value.replace(/"/g,"&quot;"):value;return value},integrate:function(priodata,dataset,as_defaults){dataset=self.helper.clone(dataset);if(!self.helper.isObject(priodata))return dataset;if(!self.helper.isObject(dataset))return self.helper.clone(priodata);for(const key in priodata){if(!as_defaults||self.helper.deepValue(dataset,key)===undefined)self.helper.deepValue(dataset,key,priodata[key])}return dataset},isComponent:function(value){return self.helper.isObject(value)&&value.Instance&&true},isDataset:value=>self.helper.isObject(value)&&self.helper.isKey(value.key),isDatastore:value=>self.helper.isObject(value)&&value.get&&value.set&&value.del&&value.source&&value.clear&&true,isDependency:function(value){if(Array.isArray(value))if(value.length>0)switch(value[0]){case"ccm.load":case"ccm.component":case"ccm.instance":case"ccm.proxy":case"ccm.start":case"ccm.store":case"ccm.get":case"ccm.set":case"ccm.del":return true}return false},isElementNode:function(value){return value instanceof Element||value instanceof DocumentFragment},isFirefox:function(){return navigator.userAgent.search("Firefox")>-1},isFramework:value=>self.helper.isObject(value)&&value.components&&value.version&&true,isGoogleChrome:function(){return/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},isInstance:value=>self.helper.isObject(value)&&self.helper.isComponent(value.component)&&value.ccm&&true,isKey:value=>{if(typeof value==="string")return self.helper.regex("key").test(value);if(Array.isArray(value)){for(let i=0;i<value.length;i++)if(!self.helper.regex("key").test(value[i]))return false;return true}return false},isLoadError:value=>{return self.helper.isObject(value)&&value.error instanceof Error&&self.helper.isObject(value.resource)&&Array.isArray(value.call)&&value.call.length>=1&&value.call[0].name==="load"},isNode:function(value){return value instanceof Node},isObject:function(value){return typeof value==="object"&&value!==null&&!Array.isArray(value)},isProxy:function(value){return self.helper.isInstance(value)&&value.component===true},isResourceDataObject:value=>self.helper.isObject(value)&&value.url&&(value.context||value.method||value.params||value.attr||value.ignore_cache||value.type)&&true,isSafari:function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},isSpecialObject:value=>{return!!(value===window||self.helper.isNode(value)||self.helper.isFramework(value)||self.helper.isInstance(value)||self.helper.isComponent(value)||self.helper.isDatastore(value)||window.jQuery&&value instanceof jQuery)},isSubset:function(obj,other){other=self.helper.toDotNotation(other,true);for(const key in obj)if(typeof obj[key]==="object"&&typeof other[key]==="object"){if(JSON.stringify(obj[key])!==JSON.stringify(other[key]))return false}else if(obj[key]!==other[key])return false;return true},loadFramework:async url=>{let resource={};if(self.helper.isObject(url)){url=self.helper.clone(url);resource.url=url.url;delete url.url;resource.attr=url}else resource={url:url};const version=(resource.url.match(/(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)/)||["latest"])[0];!ccm[version]&&await self.load(resource);return ccm[version]},loading:function(instance){const element=instance?instance.element.parentNode:document.head;if(!element.querySelector("#ccm_keyframe")){const style=document.createElement("style");style.id="ccm_keyframe";style.appendChild(document.createTextNode("@keyframes ccm_loading { to { transform: rotate(360deg); } }"));element.appendChild(style)}return self.helper.html({class:"ccm_loading",style:"display: grid; padding: 0.5em;",inner:{style:"align-self: center; justify-self: center; display: inline-block; width: 2em; height: 2em; border: 0.3em solid #f3f3f3; border-top-color: #009ee0; border-left-color: #009ee0; border-radius: 50%; animation: ccm_loading 1.5s linear infinite;"}})},log:message=>console.log("[ccm]",message),makeIterable:function(array_like){return Array.prototype.slice.call(array_like)},onFinish:async(instance,results)=>{const settings=instance.onfinish;if(!settings)return;if(results===undefined&&instance.getValue)results=instance.getValue();if(typeof settings==="function")return settings(instance,results);if(typeof settings==="string")return this.executeByName(settings,[instance,results]);if(settings.confirm&&confirm(!settings.confirm))return;const user=self.context.find(instance,"user");settings.login&&user&&await user.login();if(settings.convert)results=(await self.load({url:settings.convert.module,type:"module",import:settings.convert.import}))(results);settings.log&&console.log(results);if(settings.clear)instance.element.innerHTML="";if(settings.store){const dataset=self.helper.clone(results);if(settings.store===true){settings.store={};if(self.helper.isObject(instance.data)&&self.helper.isDatastore(instance.data.store)){settings.store=self.helper.clone(instance.data);settings.store.settings=settings.store.store.source();delete settings.store.store}}if(settings.store.key)dataset.key=settings.store.key;if(!Array.isArray(dataset.key))dataset.key=[dataset.key!==true&&dataset.key||self.helper.generateKey()];settings.store.user&&user&&user.isLoggedIn()&&dataset.key.push(user.data().user);settings.store.unique&&dataset.key.push(self.helper.generateKey());if(settings.store.permissions)dataset._=settings.store.permissions;if(user)settings.store.settings.user=user;await self.set(settings.store.settings,dataset)}if(settings.alert)alert(settings.alert);settings.restart&&await instance.start();if(settings.render)if(self.helper.isObject(settings.render)&&settings.render.component){let config=settings.render.config;if(!config)config={};const result=await self.start(settings.render.component,config);self.helper.replace(instance.root,result.root)}else self.helper.replace(instance.root,self.helper.html(settings.render));settings.callback&&settings.callback(instance,results)},parse:(string,reviver)=>JSON.parse(string.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f").replace(/[\u0000-\u0019]+/g,""),reviver),prepend:function(parent,node){node=self.helper.protect(node);if(parent.hasChildNodes())parent.insertBefore(node,parent.firstChild);else parent.appendChild(node)},privatize:function(instance,properties){const keep=properties===true;const obj={};if(properties&&!keep)for(let i=1;i<arguments.length;i++)privatizeProperty(arguments[i]);else for(const key in instance)privatizeProperty(key);return obj;function privatizeProperty(key){if(key===true)return;switch(key){case"ccm":case"component":case"config":case"data":case"dependency":case"element":case"id":case"index":case"onfinish":case"parent":case"root":break;default:if(self.helper.isInstance(instance[key])&&instance[key].parent&&instance[key].parent.index===instance.index)return;if(typeof instance[key]==="function")return;if(instance[key]!==undefined)obj[key]=instance[key];if(!keep)delete instance[key]}}},protect:value=>{if(typeof value==="string")return value.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(self.helper.isElementNode(value))[...value.querySelectorAll("script")].forEach(self.helper.removeElement);else if(typeof value==="object"&&!self.helper.isSpecialObject(value))for(const key in value)value[key]=self.helper.protect(value[key]);return value},regex:function(index){switch(index){case"filename":return/^ccm\.([a-z][a-z0-9_]*)(-(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*))?(\.min)?(\.js)$/;case"key":return/^[a-zA-Z0-9_-]+$/;case"json":return/^(({(.|\n)*})|(\[(.|\n)*])|true|false|null)$/}},removeElement:element=>element&&element.parentNode&&element.parentNode.removeChild(element),renameProperty:(obj,before,after)=>{if(obj[before]===undefined)return delete obj[before];obj[after]=obj[before];delete obj[before]},replace:(oldnode,newnode)=>oldnode.parentNode&&oldnode.parentNode.replaceChild(self.helper.protect(newnode),oldnode),setContent:function(element,content){content=self.helper.protect(content);if(typeof content==="object"){element.innerHTML="";if(Array.isArray(content))content.map(function(node){element.appendChild(node)});else element.appendChild(content)}else element.innerHTML=content},show:function(instance){instance.element.parentNode.removeChild(instance.element.parentNode.querySelector(".ccm_loading"));instance.element.style.display="block"},shuffleArray:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array},sleep:async time=>new Promise(resolve=>setTimeout(resolve,time)),solveDependencies:(obj,instance)=>new Promise((resolve,reject)=>{obj=self.helper.clone(obj);if(!self.helper.isObject(obj)&&!Array.isArray(obj))return resolve(obj);let failed=false;let counter=1;search(obj);check();function search(obj){if(self.helper.isSpecialObject(obj))return;for(const key in obj)if(obj.hasOwnProperty(key))if(key!=="ignore"){const value=obj[key];if(self.helper.isDependency(value)){counter++;self.helper.solveDependency(obj[key],instance).then(result=>{obj[key]=result;check()}).catch(result=>{failed=true;obj[key]=result;check()})}else if(self.helper.isObject(value)||Array.isArray(value))search(value)}}function check(){!--counter&&(failed?reject:resolve)(obj)}}),solveDependency:async(dependency,instance)=>{if(!self.helper.isDependency(dependency))return dependency;dependency=self.helper.clone(dependency);const operation=dependency.shift().substr("ccm.".length);switch(operation){case"load":instance&&setContext(dependency);return await self.load.apply(null,dependency);case"component":case"instance":case"proxy":case"start":case"set":case"del":if(!dependency[operation==="store"?0:1])dependency[operation==="store"?0:1]={};dependency[1]=await self.helper.solveDependency(dependency[1],instance);if(instance)dependency[operation==="store"?0:1].parent=instance;return await self[operation].apply(null,dependency);case"store":case"get":if(!dependency[0])dependency[0]={};if(instance)dependency[0].parent=instance;return await self[operation].apply(null,dependency)}function setContext(resources){for(let i=0;i<resources.length;i++){if(Array.isArray(resources[i])){setContext(resources[i]);continue}if(!self.helper.isObject(resources[i]))resources[i]={url:resources[i]};if(!resources[i].context)resources[i].context=instance.element.parentNode}}},solveDotNotation:function(obj){obj=self.helper.clone(obj);for(const key in obj)if(key.indexOf(".")!==-1){self.helper.deepValue(obj,key,obj[key]);delete obj[key]}return obj},stringify:(value,replacer,space)=>JSON.stringify(value,(key,value)=>{if(typeof value==="function"||self.helper.isSpecialObject(value))value=null;return replacer?replacer(key,value):value},space),toDotNotation:function(obj,all_levels){const result={};recursive(obj,"");return result;function recursive(obj,prefix){for(const key in obj){if(typeof obj[key]==="object"){if(all_levels)result[prefix+key]=obj[key];recursive(obj[key],prefix+key+".")}else result[prefix+key]=obj[key]}}},toJSON:value=>self.helper.parse(self.helper.stringify(value)),transformStringArray:function(arr){var obj={};arr.map(function(value){obj[value]=true});return obj},unescapeHTML:value=>{const element=document.createElement("div");return value.replace(/\&[#0-9a-z]+;/gi,x=>{element.innerHTML=x;return element.innerText})},wait:function(time,callback){window.setTimeout(callback,time)}}};self.load.timeout=0;if(self.version&&!ccm[self.version()])ccm[self.version()]=self;if(!ccm.version||self.helper.compareVersions(self.version(),ccm.version())>0){ccm.latest=self;Object.assign(ccm,self.helper.clone(self))}async function prepareConfig(config={},defaults={}){config=await self.helper.solveDependency(config);let result=defaults;result=self.helper.integrate(await self.helper.solveDependency(config.key),result);result=self.helper.integrate(config,result);delete result.key;return result}async function changeFrameworkVersion(component,config){const source=config&&config.ccm;if(source){component.ccm=ccm[(await self.helper.loadFramework(source)).version()];component.ccm.url=self.helper.isObject(source)?source.url:source;config&&delete config.ccm}}})();