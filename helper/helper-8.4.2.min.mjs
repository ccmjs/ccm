let ccm=window.ccm;export const use=version=>ccm=version;export const action=async(action,context)=>{if(!Array.isArray(action))action=[action];action[0]=await ccm.helper.solveDependency(action[0]);if(typeof action[0]==="function")return action[0].apply(context,action.slice(1));else return executeByName(action[0],action.slice(1),context)};export const executeByName=(name,args,context)=>{const namespaces=name.split(".");let flag;if(namespaces[0]==="this")flag=!!namespaces.shift();let namespace=flag?context:window;name=namespaces.pop();namespaces.forEach((value=>namespace=namespace[value]));return namespace[name].apply(context,args)};export const asyncForEach=async(array,callback)=>{for(let i=0;i<array.length;i++)await callback(array[i],i,array)};export const sleep=time=>new Promise((resolve=>setTimeout(resolve,time)));export const triggerEvent=(instance,event,data={})=>{data.instance=instance.index;data.root=ccm.context.root(instance).index;data.event=event;document.dispatchEvent(new CustomEvent("ccm-"+instance.component.name,{detail:data}))};export const hasDomContact=instance=>document.contains(ccm.context.root(instance).root)&&(hasParentContact(instance)||!instance.parent);export const hasParentContact=instance=>instance.parent&&instance.parent.element.contains(instance.root);export const isEqual=(obj1,obj2)=>{function getType(item){return Object.prototype.toString.call(item).slice(8,-1).toLowerCase()}function compareArrays(){if(obj1.length!==obj2.length)return false;for(let i=0;i<obj1.length;i++){if(!isEqual(obj1[i],obj2[i]))return false}return true}function compareObjects(){if(Object.keys(obj1).length!==Object.keys(obj2).length)return false;for(let key in obj1){if(Object.prototype.hasOwnProperty.call(obj1,key)){if(!isEqual(obj1[key],obj2[key]))return false}}return true}function compareFunctions(){return obj1.toString()===obj2.toString()}function comparePrimitives(){return obj1===obj2}let type=getType(obj1);if(type!==getType(obj2))return false;if(type==="array")return compareArrays();if(type==="object")return compareObjects();if(type==="function")return compareFunctions();return comparePrimitives()};export const isFirefox=()=>navigator.userAgent.search("Firefox")>-1;export const isGoogleChrome=()=>/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);export const isSafari=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent);export const arrToObj=arr=>{if(!Array.isArray(arr))return null;const result={};arr.forEach((value=>{if(ccm.helper.isObject(value))result[value.key]=value;else result[value]=true}));return result};export const assign=(target={},source={})=>{source=ccm.helper.toDotNotation(source);for(let key in source)ccm.helper.deepValue(target,key,source[key]);return target};export function cleanHTML(string){const div=document.createElement("div");div.innerHTML=string;return div.textContent}export const cleanObject=(obj,deep)=>{if(Array.isArray(obj)){for(let i=obj.length-1;i>=0;i--)if(!obj[i])obj.splice(i,1);else if(deep&&typeof obj[i]==="object"&&!ccm.helper.isSpecialObject(obj[i]))cleanObject(obj[i])}else for(const key in obj)if(obj.hasOwnProperty(key))if(!obj[key])delete obj[key];else if(deep&&typeof obj[key]==="object"&&!ccm.helper.isSpecialObject(obj[key]))cleanObject(obj[key]);return obj};export const decodeJSON=str=>{if(typeof str!=="string"||!ccm.helper.regex("json").test(str))return null;return ccm.helper.parse(str.replace(/%'%/g,'"'))};export const encodeJSON=json=>{if(typeof json!=="object")return"";return ccm.helper.stringify(json).replace(/"/g,"%'%")};export const escapeHTML=value=>{const text=document.createTextNode(value);const div=document.createElement("div");div.appendChild(text);return div.innerHTML};export const filterData=(data,mask)=>{if(!mask)return ccm.helper.clone(data);data=ccm.helper.toDotNotation(data,true);mask=ccm.helper.toDotNotation(mask);const result={};for(const key in mask)ccm.helper.deepValue(result,key,mask[key]?data[key]:"");return result};export const filterProperties=(obj,...keys)=>{const result={};keys.forEach((key=>{if(obj[key]!==undefined)result[key]=obj[key]}));return result};export const params=(values={},push,reset)=>{const searchParams=new URLSearchParams(reset?"":window.location.search);for(const key in values)values[key]?searchParams.set(key,values[key]):searchParams.delete(key);Object.keys(values).length&&window.history[(push?"push":"replace")+"State"]("","","?"+searchParams.toString().replaceAll("+","%20"));return window.location.search.slice(1).split("&").reduce(((acc,s)=>{const[k,v]=s.split("=");return Object.assign(acc,{[k]:decodeURIComponent(v)})}),{})};const randomFromRange=(min,max)=>{if(isNaN(min))throw new Error("Your min value "+min+" is actually not a number!");if(isNaN(max))throw new Error("Your max value "+max+" is actually not a number!");if(max<=min){throw new Error("Your minimum number("+min+") is great than or equal to your maximum number ("+max+").")}else{const differ=max-min;const random=Math.floor(Math.random()*differ);return min+random}};export const renameProperty=(obj,before,after)=>{obj[after]=obj[before];delete obj[before];if(obj[after]===undefined)delete obj[after]};export const shuffleArray=array=>{for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}return array};export const toKey=str=>str.trim().replace(/\W/g,"");export const unescapeHTML=value=>{const element=document.createElement("div");return value.replace(/\&[#0-9a-z]+;/gi,(str=>{element.innerHTML=str;return element.innerText}))};export const xml2json=xml=>{const json={};recursive(json,xml.firstElementChild);return json;function recursive(obj,elem){if(elem.childElementCount){obj[elem.tagName]={};Array.from(elem.children).forEach((child=>recursive(obj[elem.tagName],child)))}else obj[elem.tagName]=elem.innerHTML}};export const dataset=async(settings={})=>{settings=ccm.helper.clone(settings);if(!ccm.helper.isDatastore(settings.store))return ccm.helper.isObject(settings)?settings:{};if(!settings.key)settings.key=ccm.helper.generateKey();if(ccm.helper.isDataset(settings.key))return settings.convert?await settings.convert(settings.key):settings.key;const user=ccm.context.find(settings.store,"user");user&&settings.login&&await user.login();if(ccm.helper.isInstance(user)&&settings.user&&user.isLoggedIn())settings.key=[settings.key,user.data().key];let dataset=await settings.store.get(settings.key);if(!dataset){dataset={key:settings.key};if(settings.permissions)dataset._=settings.permissions}if(settings.convert)dataset=await settings.convert(dataset);return dataset};export const onFinish=async(settings,results,user)=>{let instance;settings=ccm.helper.clone(settings);results=ccm.helper.clone(results);if(ccm.helper.isInstance(settings)){instance=settings;if(!results&&settings.getValue)results=settings.getValue();settings=settings.onfinish;if(!user)user=ccm.context.find(instance,"user")}if(!settings)return;if(typeof settings==="function")return settings(results,instance);if(settings.confirm&&!confirm(settings.confirm))return;if(settings.condition&&!await settings.condition(results,instance))return;user&&settings.login&&await user.login();if(settings.convert)results=await settings.convert(results,instance);settings.log&&console.log(results);if(instance&&settings.clear)instance.element.innerHTML="";if(settings.store&&results){const dataset=ccm.helper.clone(results);if(instance&&settings.store===true){settings.store={};if(ccm.helper.isObject(instance.data)&&ccm.helper.isDatastore(instance.data.store)){settings.store=ccm.helper.clone(instance.data);settings.store.settings=settings.store.store;delete settings.store.store}}dataset.key=[settings.store.key||ccm.helper.generateKey()];if(settings.store.user&&user&&user.isLoggedIn()){dataset.key.push(user.data().key);if(!dataset.user)dataset.user=user.data().key}settings.store.unique&&dataset.key.push(ccm.helper.generateKey());if(dataset.key.length===1)dataset.key=dataset.key[0];else if(!dataset.app)dataset.app=dataset.key[0];if(settings.store.permissions)dataset._=settings.store.permissions;if(user)settings.store.settings.user=user;await ccm.store(settings.store.settings).then((store=>store.set(dataset)))}if(settings.alert)alert(settings.alert);instance&&settings.restart&&await instance.start();if(settings.render)if(ccm.helper.isObject(settings.render)&&settings.render.component){const config=settings.render.config||{};if(!config.root&&instance)config.root=instance&&instance.root.parentElement;if(!config.parent&&config.parent!==false&&instance&&instance.parent)config.parent=instance.parent;await ccm.start(settings.render.component,config)}else instance&&setContent(instance.root,ccm.helper.html(settings.render),ccm);settings.callback&&await settings.callback(results,instance)};export const append=(elem,...content)=>{content.forEach((content=>{if(Array.isArray(content))return content.forEach((content=>append(elem,content)));content=protect(ccm.helper.html(content));if(typeof content==="object")elem.appendChild(content);else elem.insertAdjacentHTML("beforeend",content)}))};export const prepend=(elem,...content)=>{content.reverse().forEach((content=>{if(Array.isArray(content))return content.reverse().forEach((content=>prepend(elem,content)));if(!elem.hasChildNodes())return append(elem,content);content=protect(ccm.helper.html(content));if(typeof content==="object")elem.insertBefore(content,elem.firstChild);else elem.insertAdjacentHTML("afterbegin",content)}))};export const remove=elem=>elem&&elem.parentNode&&elem.parentNode.removeChild(elem);export const replace=(elem,other)=>elem.parentNode&&elem.parentNode.replaceChild(protect(ccm.helper.html(other)),elem);export const setContent=(elem,...content)=>{elem.innerHTML="";append(elem,content)};export const fillForm=(elem,data)=>{data=ccm.helper.clone(data);const dot=ccm.helper.toDotNotation(data,true);for(const key in dot)data[key]=dot[key];for(const key in data){if(data[key]===undefined)continue;if(typeof data[key]==="object")data[key]=encodeJSON(data[key],ccm);elem.querySelectorAll('[name="'+key+'"]').forEach((input=>{if(input.type==="checkbox"){if(data[key]===input.value)input.checked=true;else if(input.value&&typeof data[key]==="string"&&data[key].charAt(0)==="[")decodeJSON(data[key],ccm).forEach((value=>{if(value===input.value)input.checked=true}));else input.checked=!!data[key]}else if(input.type==="radio"){if(data[key]===input.value)input.checked=true}else if(input.tagName.toLowerCase()==="select"){if(input.hasAttribute("multiple"))data[key]=decodeJSON(data[key],ccm);input.querySelectorAll("option").forEach((option=>{if(input.hasAttribute("multiple"))data[key].forEach((value=>encodeJSON(value,ccm)===(option.value?option.value:option.innerHTML.trim())&&(option.selected=true)));else if(data[key]===(option.value?option.value:option.innerHTML.trim()))option.selected=true}))}else if(input.value===undefined)input.innerHTML=protect(data[key],ccm);else input.value=data[key]}))}};export const formData=(elem,settings={})=>{const data={};elem.querySelectorAll("[name]").forEach((input=>{if(settings.enabled_only&&input.disabled)return;let name=input.getAttribute("name");if(input.type==="checkbox"){const value=input.checked?input.value==="on"?true:input.value:input.value==="on"?false:"";const multi=[...elem.querySelectorAll('[name="'+name+'"]')].length>1;if(multi){if(!data[name])data[name]=[];value&&data[name].push(value)}else data[name]=value}else if(input.type==="radio")data[name]=input.checked?input.value:data[name]?data[name]:"";else if(input.tagName.toLowerCase()==="select"){let result=[];if(input.hasAttribute("multiple"))input.querySelectorAll("option").forEach((option=>option.selected&&result.push(option.value?option.value:option.inner)));else input.querySelectorAll("option").forEach((option=>{if(option.selected)result=option.value?option.value:option.inner}));data[name]=result}else if(input.type==="number"||input.type==="range"){let value=parseFloat(input.value);if(isNaN(value))value="";data[name]=value}else if(input.value!==undefined)data[name]=input.value;else data[input.getAttribute("name")]=input.innerHTML;try{if(typeof data[name]==="string")if(ccm.helper.regex("json").test(data[name]))data[name]=decodeJSON(data[name],ccm)}catch(err){}}));return ccm.helper.solveDotNotation(data)};export const appDependency=async app=>{if(ccm.helper.isDependency(app)){app[0]="ccm.start";return app}if(typeof app!=="string")return null;if(app.startsWith("http")){const char=app.includes("?")?"?":"#";const params=app.substr(app.indexOf(char)+1).split("&").reduce(((acc,str)=>{const[key,value]=str.split("=");return Object.assign(acc,{[key]:decodeURIComponent(value)})}),{});if(params.app){params.app=params.app.split(",");const component=await ccm.get({name:"dms2-components",url:"https://ccm2.inf.h-brs.de"},params.app[0]);return["ccm.start",component.path,["ccm.get",{name:"dms2-configs",url:"https://ccm2.inf.h-brs.de"},params.app]]}if(params.id){const app_meta=await ccm.get({name:"dms-apps",url:"https://ccm2.inf.h-brs.de"},params.id);return["ccm.start",app_meta.path,["ccm.get",app_meta.source[0],app_meta.source[1]]]}if(params.key)return["ccm.start",params.component,["ccm.get",{name:params.name,url:params.url},params.key]];if(params.component){const{store:store,key:key}=JSON.parse(params.config);return["ccm.start",params.component,["ccm.get",store,key]]}}if(app.startsWith("<")){const html=ccm.helper.html(`<div>${app}</div>`,undefined,{no_evaluation:true});const component=html.firstChild.getAttribute("src")||html.firstChild.getAttribute("component");const config=html.lastChild.getAttribute("src")||html.lastChild.getAttribute("key");const result=["ccm.start",component];result.push(JSON.parse(config));return result}return null};export const appURL=(url,component,config={})=>{if(config.store&&config.key)config=["ccm.get",ccm.helper.isDatastore(config.store)?config.store.source():config.store,config.key];if(config.includes&&config.includes(".mjs#"))config=["ccm.load",config];return`${url}?component=${encodeURIComponent(component)}&config=${encodeURIComponent(ccm.helper.stringify(config))}`};export const bookmarklet=(component,config={})=>{if(config.store&&config.key)config=["ccm.get",ccm.helper.isDatastore(config.store)?config.store.source():config.store,config.key];if(config.includes&&config.includes(".mjs#"))config=["ccm.load",config];component=encodeURI(component);const index=encodeURI(ccm.helper.convertComponentURL(component).index);config=encodeURI(ccm.helper.stringify(config));return`javascript:(function()%7Bvar%20u%3D%22${component}%22%2Ci%3D%22${index}%22%2Cc%3D'${config}'%2Ce%3Ddocument.createElement(%22script%22)%3Be.setAttribute(%22src%22%2Cu)%2Cdocument.head.appendChild(e)%2C(e%3Ddocument.createElement(%22ccm-%22%2Bi)).setAttribute(%22src%22%2Cc)%2Cdocument.body.appendChild(e)%7D)()`};export const decomposeAppURL=app_url=>{const result={};try{app_url=decodeURIComponent(app_url)}catch(e){}app_url.substr(app_url.indexOf("?")+1).split("&").forEach((part=>{part=part.split("=");result[part[0]]=part[1]}));if(result.config)if(result.config==="{}")delete result.config;else result.config=JSON.parse(result.config);return result};export const decomposeEmbedCode=embed_code=>{embed_code=ccm.helper.html(`<div>${embed_code}</div>`,undefined,{no_evaluation:true});const result={component:embed_code.firstChild.getAttribute("src")||embed_code.firstChild.getAttribute("component"),config:embed_code.lastChild.getAttribute("src")};if(result.config)if(result.config==="{}")delete result.config;else result.config=JSON.parse(result.config);return result};export const downloadApp=async(embed_code,filename="app",title="App",template="https://ccmjs.github.io/akless-components/resources/templates/app.html")=>{template=await fetch(template).then((response=>response.text()));template=template.replace("__TITLE__",title).replace("__EMBED__",embed_code);download(`${filename}.html`,template)};export const embedCode=(component,config={},noscript)=>{const index=ccm.helper.convertComponentURL(component).index;if(config.store&&config.key)config=["ccm.get",ccm.helper.isDatastore(config.store)?config.store.source():config.store,config.key];if(config.includes(".mjs#"))config=["ccm.load",config];if(noscript)return`<ccm-app component='${component}' src='${ccm.helper.stringify(config)}'></ccm-app>`;else return`<script src='${component}'><\/script><ccm-${index} src='${ccm.helper.stringify(config)}'></ccm-${index}>`};export const iBookWidget=async(embed_code,filename="app",title="App",folder="app",template="https://ccmjs.github.io/akless-components/resources/templates/app.html",info_file="https://ccmjs.github.io/akless-components/resources/templates/ibook_widget/Info.plist",image_file="https://ccmjs.github.io/akless-components/resources/templates/ibook_widget/Default.png")=>{template=await fetch(template).then((response=>response.text()));template=template.replace("__TITLE__",title).replace("__EMBED__",embed_code);info_file=await fetch(info_file).then((response=>response.blob()));image_file=await fetch(image_file).then((response=>response.blob()));!window.JSZip&&await loadScript("https://ccmjs.github.io/akless-components/libs/jszip/jszip.min.js");!window.saveAs&&await loadScript("https://ccmjs.github.io/akless-components/libs/FileSaver/FileSaver.js");let widgetZip=new JSZip;widgetZip.folder(`${folder}.wdgt`).file("index.html",template);widgetZip.folder(`${folder}.wdgt`).file("Info.plist",info_file);widgetZip.folder(`${folder}.wdgt`).file("Default.png",image_file);widgetZip=await widgetZip.generateAsync({type:"blob"});saveAs(widgetZip,`${filename}.zip`)};export const scorm=async(embed_code,filename="app",title="App",identifier="App",html_template="https://ccmjs.github.io/akless-components/resources/templates/scorm/index.html",manifest_template="https://ccmjs.github.io/akless-components/resources/templates/scorm/imsmanifest.xml",api_file="https://ccmjs.github.io/akless-components/resources/templates/scorm/SCORM_API_wrapper.js")=>{html_template=await fetch(html_template).then((response=>response.text()));html_template=html_template.replace("__TITLE__",title).replace("__EMBED__",embed_code);manifest_template=await fetch(manifest_template).then((response=>response.text()));manifest_template.replace("__IDENTIFIER__",identifier).replace("__TITLE__",title);api_file=await fetch(api_file).then((response=>response.blob()));!window.JSZip&&await loadScript("https://ccmjs.github.io/akless-components/libs/jszip/jszip.min.js");!window.saveAs&&await loadScript("https://ccmjs.github.io/akless-components/libs/FileSaver/FileSaver.js");let widgetZip=new JSZip;widgetZip.file("index.html",html_template);widgetZip.file("imsmanifest.xml",manifest_template);widgetZip.file("SCORM_API_wrapper.js",api_file);widgetZip=await widgetZip.generateAsync({type:"blob"});saveAs(widgetZip,`${filename}.zip`)};export const copyToClipboard=elem=>{elem.select();document.execCommand("copy")};export const download=(filename,content,mime="text/html;charset=utf-8")=>{const element=document.createElement("a");element.setAttribute("href",`data:${mime},${encodeURIComponent(content)}`);element.setAttribute("download",filename);element.style.display="none";document.body.appendChild(element);element.click();document.body.removeChild(element)};export const fullscreen=elem=>{if(elem.requestFullscreen)elem.requestFullscreen();else if(elem.mozRequestFullScreen)elem.mozRequestFullScreen();else if(elem.webkitRequestFullscreen)elem.webkitRequestFullscreen();else if(elem.msRequestFullscreen)elem.msRequestFullscreen()};export const loadScript=async url=>new Promise(((resolve,reject)=>{const script=document.createElement("script");document.head.appendChild(script);script.onload=()=>{document.head.removeChild(script);resolve()};script.onerror=()=>{document.head.removeChild(script);reject()};script.async=true;script.src=url}));export const progressBar=({elem:elem,actual:actual,total:total=100,color:color="#4CAF50",speed:speed=10})=>{const main=document.createElement("div");console.log(total);main.innerHTML=`\n    <div>${Number.isInteger(actual)?actual+(total?"/"+total:""):""}</div>\n    <div>\n      <div></div>\n    </div>\n  `;main.setAttribute("style","min-width: 200px; max-width: 90%; margin: 1em 5%; padding: 0.5em 1em; display: flex; align-items: center; border: 1px solid lightgray; border-radius: 20px;");elem.appendChild(main);const points=main.querySelector("div > div:first-child");points.setAttribute("style","font-family: Verdana, Arial, sans-serif; font-size: 15px; font-stretch: expanded; margin-right: 0.5em; top: 2px;");const progress_bar=main.querySelector("div > div:last-child");progress_bar.setAttribute("style","width: 100%; height: 20px; background-color: #ddd; border-radius: 10px; overflow: hidden; position: relative;");const progress=progress_bar.querySelector("div");progress.setAttribute("style","width: 0%; height: 20px; background-color:"+color+"; position: absolute;");if(Number.isInteger(actual))setTimeout((()=>{const goal=actual*progress_bar.offsetWidth/total;let width=1;let id=setInterval((()=>width>=goal?clearInterval(id):progress.style.width=(width+=goal/1e3*speed)+"px"),8)}),1);else progress.style.width=(actual?progress_bar.offsetWidth:0)+"px"};export const touchControl=(elem,{onLeft:onLeft,onRight:onRight})=>{let reachedEdge=false;let touchStart=null;let touchDown=false;elem.addEventListener("touchstart",(()=>touchDown=true));elem.addEventListener("touchmove",(event=>{if(elem.scrollLeft===0||elem.scrollLeft===elem.scrollWidth-elem.clientWidth)reachedEdge=true;else{reachedEdge=false;touchStart=null}if(reachedEdge&&touchDown){if(touchStart===null)touchStart=event.changedTouches[0].clientX;else{let distance=event.changedTouches[0].clientX-touchStart;if(distance>100){touchStart=null;reachedEdge=false;touchDown=false;onLeft()}else if(distance<-100){touchStart=null;reachedEdge=false;touchDown=false;onRight()}}}}));elem.addEventListener("touchend",(()=>{touchStart=null;touchDown=false}))};export const hasPermission=(settings,user,operation)=>{settings=settings._?settings._:settings;if(user&&user.getValue)user=user.getValue();if(!settings||!settings.creator||!settings.realm)return true;if(Array.isArray(settings.access))return true;const access=typeof settings.access==="object"?settings.access[operation]:settings.access;if(access==="all")return true;if(!user||!user.key||user.realm!==settings.realm)return false;if(user.key===settings.creator)return true;if(access==="group")return Array.isArray(settings.group)&&settings.group.includes(user.key);const groups=access.split(",");for(let i=0;i<groups.length;i++)if(settings.group&&settings.group[groups[i]]&&settings.group[groups[i]].includes(user.key))return true;return false};export const isCreator=(dataset,user)=>{if(user.getValue)user=user.getValue();return user&&dataset&&dataset._&&user.key&&user.key===dataset._.creator&&user.realm&&user.realm===dataset._.realm};export const privatize=(instance,...keys)=>{let keep=false;if(keys[0]===true)keep=keys.shift();const obj={};if(keys.length)keys.forEach((key=>privatizeProperty(key)));else for(const key in instance)privatizeProperty(key);return obj;function privatizeProperty(key){if(key===true)return;switch(key){case"ccm":case"component":case"config":case"element":case"id":case"index":case"inner":case"parent":case"root":case"shadow":break;default:if(typeof instance[key]==="function")return;if(instance[key]!==undefined)obj[key]=instance[key];if(!keep)delete instance[key]}}};export const protect=html=>{if(typeof html==="string")return html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");if(ccm.helper.isElement(html))[...html.querySelectorAll("script")].forEach(remove);return html};
//# sourceMappingURL=helper-8.4.2.min.mjs.map